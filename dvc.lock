schema: '2.0'
stages:
  load_data:
    cmd: python -m src.data.make_dataset --config=params.yaml
    deps:
    - path: data/raw/test.csv
      md5: f4088e849b8f561eb3e9055a4251567a
      size: 248941
    - path: data/raw/train.csv
      md5: 3fe5dc9c07027b120ea0ff061018594d
      size: 399312
    - path: src/config.py
      md5: f7eab9f5f533667a1213170b7ee66140
      size: 2808
    - path: src/data/make_dataset.py
      md5: 8e188b5adce78cfe30cf72cb266e9c44
      size: 1188
    - path: src/data/preprocess.py
      md5: 364f2697d29ba1d8242267019e661036
      size: 1475
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 375
    params:
      params.yaml:
        load_data:
          data_train_path: data/raw/train.csv
          data_test_path: data/raw/test.csv
        preprocess_data:
          cols:
            TARGET_COLS:
            - Артериальная гипертензия
            - ОНМК
            - Стенокардия, ИБС, инфаркт миокарда
            - Сердечная недостаточность
            - Прочие заболевания сердца
            ID_COL: ID
            EDU_COL: Образование
            SEX_COL: Пол
            FREQ_COL: Частота пасс кур
            CAT_COLS:
            - Пол
            - Семья
            - Этнос
            - Национальность
            - Религия
            - Образование
            - Профессия
            - Статус Курения
            - Частота пасс кур
            - Алкоголь
            - Время засыпания
            - Время пробуждения
            OHE_COLS:
            - Вы работаете?
            - Выход на пенсию
            - Прекращение работы по болезни
            - Сахарный диабет
            - Гепатит
            - Онкология
            - Хроническое заболевание легких
            - Бронжиальная астма
            - 'Туберкулез легких '
            - ВИЧ/СПИД
            - Регулярный прим лекарственных средств
            - Травмы за год
            - Переломы
            - Пассивное курение
            - Сон после обеда
            - Спорт, клубы
            - Религия, клубы
            REAL_COLS:
            - Возраст курения
            - Сигарет в день
            - Возраст алког
          paths:
            preprocessed_train_data_pkl: data/preprocessed/train_data.pkl
            preprocessed_target_data_pkl: data/preprocessed/target_data.pkl
            preprocessed_test_data_pkl: data/preprocessed/test_data.pkl
    outs:
    - path: data/preprocessed/test_data.pkl
      md5: edeefe115658b8aa683ee2acb4b82d2a
      size: 43142
    - path: data/preprocessed/train_data.pkl
      md5: 8e9f23906108618d7b9f95323ba6ae33
      size: 99796
  generate_features:
    cmd: python -m src.features.build_features --config=params.yaml
    deps:
    - path: data/preprocessed/test_data.pkl
      md5: edeefe115658b8aa683ee2acb4b82d2a
      size: 43142
    - path: data/preprocessed/train_data.pkl
      md5: 8e9f23906108618d7b9f95323ba6ae33
      size: 99796
    - path: src/config.py
      md5: f7eab9f5f533667a1213170b7ee66140
      size: 2808
    - path: src/features/build_features.py
      md5: 8e439f7f77fb7c8daaa41c3d5c1d47bf
      size: 1232
    - path: src/features/features.py
      md5: f9e49793825db16ccadb19e21d4c5ecb
      size: 1150
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 375
    params:
      params.yaml:
        generate_features:
          cols:
            WAKE_UP_TIME_COL: Время пробуждения
            FALL_ASLEEP_COL: Время засыпания
            SLEEP_BEHAVIORS_COL: Жаворонок/Сова/Воробей
            SLEEP_DURATION_COL: Длительность сна (ч.)
          paths:
            featurized_train_data_pkl: data/features/featurized_train_data_pkl
            featurized_test_data_pkl: data/features/featurized_test_data_pkl
    outs:
    - path: data/features/featurized_test_data_pkl
      md5: fdf588f669a46f17dff05cf6eb7e9b1b
      size: 49447
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
  train_catboost:
    cmd: python -m src.models.catboost.train_model --config=params.yaml
    deps:
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
    - path: src/config.py
      md5: f7eab9f5f533667a1213170b7ee66140
      size: 2808
    - path: src/models/catboost/train_model.py
      md5: 64eb42aa3c2110aa9dec82020e5aca3c
      size: 2093
    - path: src/models/utils.py
      md5: d67cec1ad47ceaeafc0792aa09c80a94
      size: 2947
    params:
      params.yaml:
        train:
          CAT_COLS:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Образование
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Жаворонок/Сова/Воробей
          hyperopt:
            best_model_file: models/hyperopt_best_model.joblib
          catboost:
            iterations: 5000
            loss_function: MultiLogloss
            eval_metric: MultiLogloss
            learning_rate: 0.03
            bootstrap_type: Bayesian
            boost_from_average: false
            ctr_leaf_count_limit: 1
            leaf_estimation_iterations: 1
            leaf_estimation_method: Gradient
            catboost_best_model_path: models/catboost_best_model.joblib
    outs:
    - path: catboost_info/learn_error.tsv
      md5: 61e94a5388383d8870d197a3d27b4ac4
      size: 88369
    - path: models/catboost_best_model.joblib
      md5: 1a527875b97a079c685e901396e96549
      size: 26753956
  pred_eval_catboost:
    cmd: python -m src.models.catboost.predict_model --config=params.yaml
    deps:
    - path: data/features/featurized_test_data_pkl
      md5: fdf588f669a46f17dff05cf6eb7e9b1b
      size: 49447
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
    - path: models/catboost_best_model.joblib
      md5: 1a527875b97a079c685e901396e96549
      size: 26753956
    - path: src/config.py
      md5: f7eab9f5f533667a1213170b7ee66140
      size: 2808
    - path: src/models/catboost/predict_model.py
      md5: 069ca7881b4c3bffe4537265ba8be750
      size: 1508
    - path: src/models/catboost/train_model.py
      md5: 64eb42aa3c2110aa9dec82020e5aca3c
      size: 2093
    - path: src/models/utils.py
      md5: d67cec1ad47ceaeafc0792aa09c80a94
      size: 2947
    params:
      params.yaml:
        predict:
          hyperopt:
            metrics: reports/hyperopt_metrics.json
            inference_predict: data/inference/hyperopt_predict.csv
          catboost:
            metrics: reports/catboost_metrics.json
            inference_predict: data/inference/catboost_predict.csv
    outs:
    - path: data/inference/catboost_predict.csv
      md5: 7421c3263861950b2d318da764a3647e
      size: 79750
    - path: reports/catboost_metrics.json
      md5: 6819b5140b17bb82ca7cd36393d26670
      size: 126
  train_hyperopt:
    cmd: python -m src.models.hyperopt.train_model --config=params.yaml
    deps:
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
    - path: src/config.py
      md5: f7eab9f5f533667a1213170b7ee66140
      size: 2808
    - path: src/models/hyperopt/find_best_model.py
      md5: bc3b0e6fcf09395077e1b122287fd35c
      size: 731
    - path: src/models/hyperopt/pipelines.py
      md5: b7ae575ce0c2a26f3f2967ffb48cca90
      size: 457
    - path: src/models/hyperopt/train_model.py
      md5: a10338ea9377c7acf9cc7f42e301d6f1
      size: 1703
    - path: src/models/utils.py
      md5: d67cec1ad47ceaeafc0792aa09c80a94
      size: 2947
    params:
      params.yaml:
        train:
          CAT_COLS:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Образование
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Жаворонок/Сова/Воробей
          hyperopt:
            best_model_file: models/hyperopt_best_model.joblib
          catboost:
            iterations: 5000
            loss_function: MultiLogloss
            eval_metric: MultiLogloss
            learning_rate: 0.03
            bootstrap_type: Bayesian
            boost_from_average: false
            ctr_leaf_count_limit: 1
            leaf_estimation_iterations: 1
            leaf_estimation_method: Gradient
            catboost_best_model_path: models/catboost_best_model.joblib
    outs:
    - path: models/hyperopt_best_model.joblib
      md5: 8b043562a04e3b14d8eaf0fb3ba0232a
      size: 2603633
  pred_eval_hyperopt:
    cmd: python -m src.models.hyperopt.predict_model --config=params.yaml
    deps:
    - path: data/features/featurized_test_data_pkl
      md5: fdf588f669a46f17dff05cf6eb7e9b1b
      size: 49447
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
    - path: models/hyperopt_best_model.joblib
      md5: 8b043562a04e3b14d8eaf0fb3ba0232a
      size: 2603633
    - path: src/config.py
      md5: f7eab9f5f533667a1213170b7ee66140
      size: 2808
    - path: src/models/hyperopt/predict_model.py
      md5: cce4071d97c591e7a982c25740cf8b62
      size: 1518
    - path: src/models/hyperopt/train_model.py
      md5: a10338ea9377c7acf9cc7f42e301d6f1
      size: 1703
    - path: src/models/utils.py
      md5: d67cec1ad47ceaeafc0792aa09c80a94
      size: 2947
    params:
      params.yaml:
        predict:
          hyperopt:
            metrics: reports/hyperopt_metrics.json
            inference_predict: data/inference/hyperopt_predict.csv
          catboost:
            metrics: reports/catboost_metrics.json
            inference_predict: data/inference/catboost_predict.csv
    outs:
    - path: data/inference/hyperopt_predict.csv
      md5: 72092f11b2df116a3b5eb6a5645c9ce3
      size: 79750
    - path: reports/hyperopt_metrics.json
      md5: 3e36e811e64448f20b395bdab4742bb1
      size: 129
