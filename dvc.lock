schema: '2.0'
stages:
  load_data:
    cmd: python -m src.data.make_dataset --config=params.yaml
    deps:
    - path: data/raw/test.csv
      md5: f4088e849b8f561eb3e9055a4251567a
      size: 248941
    - path: data/raw/train.csv
      md5: 3fe5dc9c07027b120ea0ff061018594d
      size: 399312
    - path: src/config.py
      md5: c24bef906a454fb3986e43a6da9510d0
      size: 1528
    - path: src/data/make_dataset.py
      md5: 7f13ea634104d784feb9a2aa4ea075fd
      size: 1205
    - path: src/data/preprocess.py
      md5: 364f2697d29ba1d8242267019e661036
      size: 1475
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 375
    params:
      params.yaml:
        load_data:
          data_train_path: data/raw/train.csv
          data_test_path: data/raw/test.csv
        preprocess_data:
          cols:
            TARGET_COLS:
            - Артериальная гипертензия
            - ОНМК
            - Стенокардия, ИБС, инфаркт миокарда
            - Сердечная недостаточность
            - Прочие заболевания сердца
            ID_COL: ID
            EDU_COL: Образование
            SEX_COL: Пол
            FREQ_COL: Частота пасс кур
            CAT_COLS:
            - Пол
            - Семья
            - Этнос
            - Национальность
            - Религия
            - Образование
            - Профессия
            - Статус Курения
            - Частота пасс кур
            - Алкоголь
            - Время засыпания
            - Время пробуждения
            OHE_COLS:
            - Пол
            - Вы работаете?
            - Выход на пенсию
            - Прекращение работы по болезни
            - Сахарный диабет
            - Гепатит
            - Онкология
            - Хроническое заболевание легких
            - Бронжиальная астма
            - 'Туберкулез легких '
            - ВИЧ/СПИД
            - Регулярный прим лекарственных средств
            - Травмы за год
            - Переломы
            - Пассивное курение
            - Сон после обеда
            - Спорт, клубы
            - Религия, клубы
            REAL_COLS:
            - Возраст курения
            - Сигарет в день
            - Возраст алког
          paths:
            preprocessed_train_data_pkl: data/preprocessed/train_data.pkl
            preprocessed_target_data_pkl: data/preprocessed/target_data.pkl
            preprocessed_test_data_pkl: data/preprocessed/test_data.pkl
    outs:
    - path: data/preprocessed/test_data.pkl
      md5: edeefe115658b8aa683ee2acb4b82d2a
      size: 43142
    - path: data/preprocessed/train_data.pkl
      md5: 8e9f23906108618d7b9f95323ba6ae33
      size: 99796
  generate_features:
    cmd: python -m src.features.build_features --config=params.yaml
    deps:
    - path: data/preprocessed/test_data.pkl
      md5: edeefe115658b8aa683ee2acb4b82d2a
      size: 43142
    - path: data/preprocessed/train_data.pkl
      md5: 8e9f23906108618d7b9f95323ba6ae33
      size: 99796
    - path: src/config.py
      md5: c24bef906a454fb3986e43a6da9510d0
      size: 1528
    - path: src/features/build_features.py
      md5: f8000faf83f3a107d81755831f66ca66
      size: 1250
    - path: src/features/features.py
      md5: f9e49793825db16ccadb19e21d4c5ecb
      size: 1150
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 375
    params:
      params.yaml:
        generate_features:
          cols:
            WAKE_UP_TIME_COL: Время пробуждения
            FALL_ASLEEP_COL: Время засыпания
            SLEEP_BEHAVIORS_COL: Жаворонок/Сова
            SLEEP_DURATION_COL: Длительность сна (ч.)
          paths:
            featurized_train_data_pkl: data/features/featurized_train_data_pkl
            featurized_test_data_pkl: data/features/featurized_test_data_pkl
    outs:
    - path: data/features/featurized_test_data_pkl
      md5: d509399459aaa45f9a4759ce973ebe31
      size: 49432
    - path: data/features/featurized_train_data_pkl
      md5: 475cdf7e45285617f9822808b3aada03
      size: 109574
  train_catboost:
    cmd: python -m src.models.catboost.train_model --config=params.yaml
    deps:
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
    - path: src/config.py
      md5: e268bd72983d6bb674453b5da8ec849d
      size: 2609
    - path: src/models/catboost/train_model.py
      md5: 2bcc35745207df6d3f57ad42f081271a
      size: 2108
    - path: src/models/utils.py
      md5: 040d5f920076d2409a6ef5e92edb7104
      size: 2944
    params:
      params.yaml:
        train:
          CAT_COLS:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Образование
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Жаворонок/Сова/Воробей
          hyperopt:
            best_model_file: models/hyperopt_best_model.joblib
          catboost:
            iterations: 5000
            loss_function: MultiLogloss
            eval_metric: MultiLogloss
            learning_rate: 0.03
            bootstrap_type: Bayesian
            boost_from_average: false
            ctr_leaf_count_limit: 1
            leaf_estimation_iterations: 1
            leaf_estimation_method: Gradient
            catboost_best_model_path: models/catboost_best_model.joblib
            catboost_metrics: reports/catboost_metrics.json
            catboost_inference_predict: data/inference/catboost_predict.csv
    outs:
    - path: models/catboost_best_model.joblib
      md5: 74385449f7019524424d17b7fe571bf1
      size: 26753956
  pred_eval_catboost:
    cmd: python -m src.models.catboost.predict_model --config=params.yaml
    deps:
    - path: data/features/featurized_test_data_pkl
      md5: fdf588f669a46f17dff05cf6eb7e9b1b
      size: 49447
    - path: data/features/featurized_train_data_pkl
      md5: 3ee7a6628f8a5885585f2260258a9951
      size: 109589
    - path: models/catboost_best_model.joblib
      md5: 74385449f7019524424d17b7fe571bf1
      size: 26753956
    - path: src/config.py
      md5: c3d65e1a0611eba949bfbe80e79da87a
      size: 2618
    - path: src/models/catboost/predict_model.py
      md5: 77d236713c86bc81449b3fabbf8e45be
      size: 1514
    - path: src/models/catboost/train_model.py
      md5: 2bcc35745207df6d3f57ad42f081271a
      size: 2108
    - path: src/models/utils.py
      md5: 040d5f920076d2409a6ef5e92edb7104
      size: 2944
    params:
      params.yaml:
        predict:
          catboost:
            metrics: reports/catboost_metrics.json
            inference_predict: data/inference/catboost_predict.csv
    outs:
    - path: data/inference/catboost_predict.csv
      md5: 7421c3263861950b2d318da764a3647e
      size: 79750
    - path: reports/catboost_metrics.json
      md5: 49bb3b76e0d16cffa481828df9a60ba4
      size: 275
